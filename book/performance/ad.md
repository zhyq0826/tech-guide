
# 广告平台业务说明

广告平台使用 redis 存储用户点击广告数据，数据结构如下

```python

    DeviceID： {
        aid:   {
            "view":     10     //剩余访问次数(int)
            "clicked":  False,  //是否点击过(boolean)
        },
        aid:   {
            "view":     10
            "clicked":  True,
        },
        ...
    }

```

数据一以 ＊key:value＊ 的形式存储于redis 中，key 是设备的id，value 为广告数组

## 存储数据量评估


### 缓存数据存储量(redis)

- 单条广告数据 **37 字节**
- 每个设备持有的广告数目商务决定，现阶段不超 **100**
- 日活跃用户 **500万**
- 数据只存储一天，即一天一清

总存储数据量 37*100*500万 = **1858MB**


### 持久化数据存储量(mongodb)

- 单条广告数据 **最大10k**
- 广告数据总数(当前8，预计不超过1000条)


## 数据访问量评估


### 广告请求规则

单个设备每日每次从接口最多取**20**条广告数据用以用户点击展示，当用户完成下列动作表示单条广告生命
周期结束：

- 用户点击完成
- 展示次数完成

当用户设备的所有广告生命周期结束，开始请求下一批广告

因此接口**访问频率**由以下因素决定

- 用户点击广告频率 (user_click_frequency)
- 广告展示频率  (ad_show_frequency)
- 总的广告数据量(由商务决定) (ad_count)
- 广告位数量 (ad_postion_count)


### 预计每个设备每日最大请求数：

 - 单组广告生命周期 (user_click_frequency, ad_show_frequency)
 - 用户活跃度

这俩个因素决定单个设备对广告的接口的每日访问频度


## 广告服务当前状态

 - 单机tornado, 单进程服务
 - 单点redis
 - mongodb adesk01 集群
